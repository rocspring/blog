#### 前言

面试遇到一个问题, `requestAnimationFrame`的执行时机, 是在EventLoop的哪个环节？ 当时突然问到这个问题，思考了一下，说猜测是在一个task执行完成后，来执行。但是这个问题一直纠结。


#### 思考

我们知道`requestAnimationFrame`是浏览器提供的钩子函数，在浏览器每次渲染之前会进行执行。浏览器的渲染，我们知道现代大部分浏览器的渲染频率都是`60/qps`。所以，这个问题其实就是浏览器渲染的时机是在EventLoop的哪个阶段？

我们知道js的执行有可能会阻塞浏览器的渲染。浏览器的渲染时机，肯定是在`EventLoop`的一个task执行完成之后。任务栈中的task执行完成后，会执行`microTask`队列中的微任务，都执行完后。会通知渲染引擎，由渲染引擎来判断是否需要进行渲染. 如果js的代码对dom有改变的情况下，渲染引擎会执行渲染，而在执行渲染之前，会执行`requestAnimationFrame`钩子函数。

#### 结果

